<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Городской супермаркет — эффектный сайт</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#04050a;
    --accent1:#00f0ff;
    --accent2:#6a00ff;
    --accent3:#ff6af3;
    --muted:rgba(255,255,255,0.82);
    --card: rgba(255,255,255,0.03);
    --glass: rgba(255,255,255,0.02);
    --neon-shadow: 0 6px 40px rgba(0,240,255,0.08), 0 2px 12px rgba(106,0,255,0.04);
    --maxw:1200px;
    font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, Arial;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html{scroll-behavior:smooth}
  body{
    min-height:100vh;
    background:linear-gradient(180deg,#03040a 0%, #071018 45%, #02040a 100%);
    color:var(--muted);
    overflow-x:hidden;
  }

  /* canvas background layer */
  #fxCanvas{position:fixed;inset:0;pointer-events:none;z-index:0;mix-blend-mode:screen;opacity:0.95}

  /* header */
  header{position:fixed;top:14px;left:14px;right:14px;z-index:60;padding:12px;border-radius:14px;display:flex;justify-content:space-between;align-items:center;backdrop-filter:blur(8px);background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);box-shadow:var(--neon-shadow)}
  .wrap{max-width:var(--maxw);margin:0 auto;width:100%;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:0 18px}
  .logo{font-weight:800;font-size:20px;background:linear-gradient(90deg,var(--accent1),var(--accent2));-webkit-background-clip:text;color:transparent;letter-spacing:1px;cursor:pointer}
  nav{display:flex;gap:16px;align-items:center}
  nav a{color:var(--muted);text-decoration:none;font-weight:600;padding:8px;border-radius:10px;position:relative;transition:all .25s}
  nav a:hover{color:#fff;text-shadow:0 0 12px rgba(0,240,255,0.08)}
  .cta{padding:9px 14px;border-radius:12px;border:none;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#02030a;font-weight:800;cursor:pointer;box-shadow:0 12px 36px rgba(0,240,255,0.06)}

  /* hero */
  .hero{min-height:86vh;display:flex;align-items:center;justify-content:center;text-align:center;padding:120px 18px 80px;position:relative;z-index:10;overflow:visible}
  .hero-inner{max-width:980px;position:relative;z-index:6}
  .hero h1{font-size:3.2rem;line-height:1.02;margin:0;background:linear-gradient(90deg,var(--accent1),var(--accent2),var(--accent3));-webkit-background-clip:text;color:transparent;text-shadow:0 8px 40px rgba(0,240,255,0.06)}
  .hero p{color:rgba(255,255,255,0.84);margin-top:16px;font-size:1.05rem}
  .hero .buttons{margin-top:28px;display:flex;gap:14px;justify-content:center;flex-wrap:wrap}
  .btn-ghost{padding:10px 16px;border-radius:999px;background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04)}
  .btn-neon{padding:12px 20px;border-radius:999px;background:linear-gradient(90deg,var(--accent2),var(--accent3));color:#02030a;font-weight:800;border:none;box-shadow:0 18px 50px rgba(106,0,255,0.08), 0 4px 18px rgba(0,240,255,0.06);transform:translateZ(0)}
  .hero .subtitle{display:block;margin-top:10px;color:rgba(255,255,255,0.72);font-size:0.95rem}

  /* glow frame around hero */
  .hero-frame{position:absolute;inset:-40px;border-radius:22px;pointer-events:none;z-index:5;filter:blur(26px);opacity:0.35;background:conic-gradient(from 90deg, rgba(0,240,255,0.04), rgba(106,0,255,0.04), rgba(162,0,255,0.04));mix-blend-mode:screen}

  /* section base */
  section{padding:78px 16px;position:relative;z-index:8}
  .container{max-width:var(--maxw);margin:0 auto}
  .section-title{display:flex;justify-content:space-between;align-items:end;gap:12px;margin-bottom:18px}
  .section-title h2{font-size:28px;background:linear-gradient(90deg,var(--accent1),var(--accent2));-webkit-background-clip:text;color:transparent}
  .lead{color:rgba(255,255,255,0.75);max-width:820px}

  /* story */
  .story{display:flex;gap:36px;align-items:center;flex-wrap:wrap}
  .story .photo{flex:1;min-width:320px;border-radius:16px;overflow:hidden;box-shadow:0 30px 60px rgba(0,0,0,0.6);transform-origin:center;transition:transform .45s var(--ease)}
  .story .photo img{width:100%;height:100%;object-fit:cover;display:block;transform:scale(1.02);transition:transform .8s ease}
  .story .photo:hover{transform:translateY(-8px) rotate(-0.4deg) scale(1.02)}
  .story .text{flex:1;min-width:320px}

  /* features - animated grid */
  .feature-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;margin-top:18px}
  .feature{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:22px;border-radius:14px;border:1px solid rgba(255,255,255,0.03);transition:transform .28s,box-shadow .28s}
  .feature:hover{transform:translateY(-12px) rotateX(2deg);box-shadow:0 30px 80px rgba(0,0,0,0.7)}
  .feature h3{color:var(--accent1);margin-bottom:8px}

  /* depts tags with shine */
  .depts{display:flex;flex-wrap:wrap;gap:12px;margin-top:18px}
  .dept{position:relative;padding:10px 14px;border-radius:999px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);font-weight:700;overflow:hidden}
  .dept:after{content:'';position:absolute;left:-40%;top:-40%;width:120%;height:120%;background:linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));transform:rotate(20deg);transition:all .6s}
  .dept:hover:after{left:20%}

  /* gallery - tilt and neon flash on hover */
  .gallery-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:18px}
  .gallery-item{position:relative;border-radius:12px;overflow:hidden;cursor:pointer;transform-style:preserve-3d;transition:transform .25s ease,box-shadow .25s}
  .gallery-item img{width:100%;height:220px;object-fit:cover;display:block;transition:transform .4s ease,filter .3s}
  .gallery-item .overlay{position:absolute;inset:0;background:linear-gradient(180deg, rgba(0,0,0,0.08), rgba(0,0,0,0.18));pointer-events:none}
  .gallery-item:hover{transform:translateY(-8px) rotateX(3deg);box-shadow:0 30px 60px rgba(0,0,0,0.6)}
  .gallery-item:hover img{transform:scale(1.06);filter:brightness(1)}
  .gallery-item .shine{position:absolute;left:-120%;top:0;width:40%;height:100%;background:linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0));transform:skewX(-18deg);transition:all .6s}
  .gallery-item:hover .shine{left:120%}

  /* lightbox */
  .lightbox{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.85);z-index:120}
  .lightbox.open{display:flex}
  .lightbox img{max-width:92%;max-height:84vh;border-radius:12px;box-shadow:0 40px 120px rgba(0,0,0,0.7)}

  /* tech cards */
  .tech .card{display:flex;gap:18px;align-items:center;padding:20px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03)}
  .tech .card img{width:260px;height:150px;object-fit:cover;border-radius:12px}

  /* contact */
  .contact-grid{display:grid;grid-template-columns:1fr 400px;gap:20px;align-items:start}
  .contact-card{padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03)}
  .contact-card input, .contact-card textarea{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--muted)}
  .contact-card button{margin-top:12px;padding:10px 14px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#02030a;font-weight:700;cursor:pointer}

  /* floating quick actions */
  .floating-actions{position:fixed;right:18px;bottom:18px;display:flex;flex-direction:column;gap:12px;z-index:70}
  .fab{width:56px;height:56px;border-radius:12px;display:grid;place-items:center;background:linear-gradient(90deg,var(--accent2),var(--accent3));color:#02030a;font-weight:800;box-shadow:0 10px 28px rgba(106,0,255,0.12);cursor:pointer;border:none}

  /* modal survey */
  .modal{position:fixed;inset:0;background:rgba(2,6,23,0.85);display:none;align-items:center;justify-content:center;z-index:130;padding:18px}
  .modal.open{display:flex}
  .modal .box{width:100%;max-width:720px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:20px;border:1px solid rgba(255,255,255,0.04)}
  .modal .box input,.modal .box textarea,.modal .box select{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--muted)}

  footer{padding:30px 18px;text-align:center;color:rgba(255,255,255,0.6);border-top:1px solid rgba(255,255,255,0.03);position:relative;z-index:8}

  /* animations and responsive */
  @media (max-width:980px){
    .contact-grid{grid-template-columns:1fr}
    .tech .card{flex-direction:column}
    header{left:10px;right:10px;border-radius:12px}
    .gallery-item img{height:180px}
    .hero h1{font-size:2.2rem}
  }
</style>
</head>
<body>

<!-- canvas background -->
<canvas id="fxCanvas"></canvas>

<header aria-label="Главная навигация">
  <div class="wrap">
    <div class="logo" onclick="scrollToTop()">Городской супермаркет</div>
    <nav>
      <a href="#story">История</a>
      <a href="#features">Отделы</a>
      <a href="#gallery">Галерея</a>
      <a href="#tech">Сервис</a>
      <a href="#contact">Контакты</a>
      <button class="cta" onclick="openSurvey()">Заполнить анкету</button>
    </nav>
  </div>
</header>

<main>
  <section class="hero" id="home" aria-label="Главный блок">
    <div class="hero-frame" aria-hidden="true"></div>
    <div class="hero-inner">
      <h1>Городской супермаркет — всё для семьи</h1>
      <p class="subtitle">Широкий ассортимент, локальные продукты и забота о покупателе. История, отделы, миссия и сервис — всё в одном месте.</p>
      <div class="buttons">
        <button class="btn-neon" onclick="document.querySelector('#features').scrollIntoView({behavior:'smooth'})">Посмотреть отделы</button>
        <button class="btn-ghost" onclick="openLightShow()">Про свет и эффекты</button>
      </div>
    </div>
  </section>

  <section id="story" class="container">
    <div class="section-title">
      <h2>Наша история</h2>
      <div class="lead">От маленького магазина у дома — к сети супермаркетов, где качество и сервис — главные приоритеты.</div>
    </div>

    <div class="story">
      <div class="photo" id="storyPhoto">
        <img src="https://images.unsplash.com/photo-1528825871115-3581a5387919?auto=format&fit=crop&w=1400&q=80" alt="Магазин фасад">
      </div>
      <div class="text">
        <h3 style="color:#fff;margin-bottom:12px">Как всё началось</h3>
        <p>Наш супермаркет открылся как семейный проект с идеей: продавать качественные продукты по честной цене. С годами мы выросли в сеть, наладили тесные отношения с фермерами и поставщиками, внедрили стандарты качества и сделали процесс покупок максимально удобным.</p>
        <p style="margin-top:12px">Мы ценим прозрачность — знаем поставщиков, следим за сроками хранения и предлагаем выбор для любого настроения: от свежих овощей до уютной выпечки.</p>
      </div>
    </div>
  </section>

  <section id="features" class="container">
    <div class="section-title">
      <h2>Отделы супермаркета</h2>
      <div class="lead">Каждый отдел — отдельное направление с профессиональным подходом и собственной философией.</div>
    </div>

    <div class="feature-grid">
      <div class="feature">
        <h3>Фрукты и овощи</h3>
        <p>Свежее с ферм: сезонные поставки и строгий контроль качества.</p>
      </div>
      <div class="feature">
        <h3>Мясной отдел</h3>
        <p>Разделка на месте, проверенные поставщики, советы по приготовлению.</p>
      </div>
      <div class="feature">
        <h3>Выпечка</h3>
        <p>Ежедневно горячая выпечка, хлеб собственной пекарни и авторские десерты.</p>
      </div>
      <div class="feature">
        <h3>Молочные продукты</h3>
        <p>Локальные и брендовые сыры, йогурты и свежие продукты каждый день.</p>
      </div>
      <div class="feature">
        <h3>Напитки</h3>
        <p>Соки, вода, кофе и специальные подборки для любого случая.</p>
      </div>
      <div class="feature">
        <h3>Товары для дома</h3>
        <p>Бытовая химия, аксессуары для кухни и решения для порядка и уюта.</p>
      </div>
    </div>

    <div class="depts" aria-hidden="false" style="margin-top:20px">
      <div class="dept">Мясо</div>
      <div class="dept">Рыба</div>
      <div class="dept">Овощи</div>
      <div class="dept">Фрукты</div>
      <div class="dept">Молочка</div>
      <div class="dept">Выпечка</div>
      <div class="dept">Напитки</div>
      <div class="dept">Товары для дома</div>
      <div class="dept">Органика</div>
      <div class="dept">Деликатесы</div>
      <div class="dept">Готовая еда</div>
      <div class="dept">Детское питание</div>
    </div>
  </section>

  <section id="gallery" class="container">
    <div class="section-title">
      <h2>Галерея</h2>
      <div class="lead">Витрины, отделы, атмосфера — через фотографии.</div>
    </div>

    <div class="gallery-grid" id="galleryGrid">
      <!-- 12 images -->
      <div class="gallery-item" onclick="openLightbox(this.querySelector('img').src)"><div class="shine"></div><img src="https://images.unsplash.com/photo-1547555996-5d09b0f6a1d9?auto=format&fit=crop&w=1200&q=80" alt="Витрина"></div>
      <div class="gallery-item" onclick="openLightbox(this.querySelector('img').src)"><div class="shine"></div><img src="https://images.unsplash.com/photo-1526312426976-3d75fa3f3e5a?auto=format&fit=crop&w=1200&q=80" alt="Полки"></div>
      <div class="gallery-item" onclick="openLightbox(this.querySelector('img').src)"><div class="shine"></div><img src="https://images.unsplash.com/photo-1527766833261-b09c3163a791?auto=format&fit=crop&w=1200&q=80" alt="Выпечка"></div>
      <div class="gallery-item" onclick="openLightbox(this.querySelector('img').src)"><div class="shine"></div><img src="https://images.unsplash.com/photo-1499636136210-6f4ee915583e?auto=format&fit=crop&w=1200&q=80" alt="Овощи"></div>
      <div class="gallery-item" onclick="openLightbox(this.querySelector('img').src)"><div class="shine"></div><img src="https://images.unsplash.com/photo-1506617420156-8e4536971650?auto=format&fit=crop&w=1200&q=80" alt="Прилавок"></div>
      <div class="gallery-item" onclick="openLightbox(this.querySelector('img').src)"><div class="shine"></div><img src="https://images.unsplash.com/photo-1544025162-d76694265947?auto=format&fit=crop&w=1200&q=80" alt="Полки магазин"></div>

      <div class="gallery-item" onclick="openLightbox(this.querySelector('img').src)"><div class="shine"></div><img src="https://images.unsplash.com/photo-1586201375754-1628a1f7b4b3?auto=format&fit=crop&w=1200&q=80" alt="Зал"></div>
      <div class="gallery-item" onclick="openLightbox(this.querySelector('img').src)"><div class="shine"></div><img src="https://images.unsplash.com/photo-1609873814042-0a3e2b9ea9cb?auto=format&fit=crop&w=1200&q=80" alt="VR shelf"></div>
      <div class="gallery-item" onclick="openLightbox(this.querySelector('img').src)"><div class="shine"></div><img src="https://images.unsplash.com/photo-1655720152091-1c28fcb3a5b1?auto=format&fit=crop&w=1200&q=80" alt="Delivery"></div>
      <div class="gallery-item" onclick="openLightbox(this.querySelector('img').src)"><div class="shine"></div><img src="https://images.unsplash.com/photo-1519710164239-da123dc03ef4?auto=format&fit=crop&w=1200&q=80" alt="Секция"></div>
      <div class="gallery-item" onclick="openLightbox(this.querySelector('img').src)"><div class="shine"></div><img src="https://images.unsplash.com/photo-1521334884684-d80222895322?auto=format&fit=crop&w=1200&q=80" alt="Товары"></div>
      <div class="gallery-item" onclick="openLightbox(this.querySelector('img').src)"><div class="shine"></div><img src="https://images.unsplash.com/photo-1526318602047-0aa6f6c6a3fd?auto=format&fit=crop&w=1200&q=80" alt="Кассы"></div>
    </div>
  </section>

  <section id="tech" class="container">
    <div class="section-title">
      <h2>Сервисы и логистика</h2>
      <div class="lead">Доставка, самовывоз, проверка заказа — как мы заботимся о вашем времени.</div>
    </div>

    <div class="tech">
      <div class="card">
        <div style="flex:1">
          <h3 style="color:#fff;margin-bottom:8px">Доставка и самовывоз</h3>
          <p style="color:rgba(255,255,255,0.82)">Экспресс-доставка в пределах города, отслеживание заказа и проверка при получении. Также доступен удобный самовывоз: оформите заказ и заберите его в ближайшем магазине.</p>
          <ul style="color:rgba(255,255,255,0.72);margin-top:10px">
            <li>Экспресс: 30–90 минут</li>
            <li>Доставка крупногабаритных товаров</li>
            <li>Персональная упаковка и контроль качества</li>
          </ul>
        </div>
        <div style="flex:0 0 260px"><img src="https://images.unsplash.com/photo-1542225159-5c1b36c0b3ab?auto=format&fit=crop&w=900&q=80" alt="Логистика"></div>
      </div>
    </div>
  </section>

  <section id="about" class="container">
    <div class="section-title">
      <h2>Миссия и ценности</h2>
      <div class="lead">Честность, качество и забота — наши главные приоритеты.</div>
    </div>
    <div class="mission">
      <p style="color:rgba(255,255,255,0.78)">Мы создаём супермаркет, где покупки — это комфортный опыт. Поддержка локальных производителей, честные цены и экологичные решения — не слова, а ежедневная практика.</p>
    </div>
  </section>

  <section id="contact" class="container">
    <div class="section-title">
      <h2>Контакты</h2>
      <div class="lead">Свяжитесь с нами или оставьте отзыв/предложение через анкету.</div>
    </div>

    <div class="contact-grid">
      <div class="contact-card">
        <h3 style="color:#fff">Напишите нам</h3>
        <form id="contactForm">
          <label style="font-weight:600;margin-top:8px;display:block">Имя</label>
          <input name="name" required placeholder="Ваше имя">
          <label style="font-weight:600;margin-top:8px;display:block">Телефон / Email</label>
          <input name="contact" required placeholder="+7 (700) 000-00-00 или email@example.com">
          <label style="font-weight:600;margin-top:8px;display:block">Сообщение</label>
          <textarea name="message" rows="4" placeholder="Ваш отзыв или предложение"></textarea>
          <div style="display:flex;gap:10px;margin-top:12px">
            <button class="btn-neon btn" type="submit">Отправить</button>
            <button type="button" class="btn-ghost btn" onclick="openSurvey()">Заполнить анкету</button>
          </div>
        </form>
        <div style="margin-top:12px;color:rgba(255,255,255,0.6)">Тел: +7 (700) 000-00-00 • support@supermarket.test</div>
      </div>

      <div class="contact-card">
        <h3 style="color:#fff">Наши адреса</h3>
        <p style="color:rgba(255,255,255,0.72)">Центральный гипермаркет, районные магазины и павильоны у метро — найдите ближайший.</p>
        <div style="height:220px;border-radius:10px;overflow:hidden;margin-top:12px">
          <iframe src="https://www.google.com/maps?q=Almaty&output=embed" style="width:100%;height:100%;border:0"></iframe>
        </div>
      </div>
    </div>
  </section>
</main>

<footer>
  <div class="container" style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
    <div>© 2025 Городской супермаркет — Качество • Уют • Удобство</div>
    <div style="color:rgba(255,255,255,0.6)">Тел: +7 (700) 000-00-00 • support@supermarket.test</div>
  </div>
</footer>

<!-- Floating quick actions -->
<div class="floating-actions" aria-hidden="true">
  <button class="fab" title="Анкета" onclick="openSurvey()">✉</button>
  <button class="fab" title="Наверх" onclick="scrollToTop()">↑</button>
</div>

<!-- Survey Modal -->
<div id="surveyModal" class="modal" aria-hidden="true">
  <div class="box" role="document">
    <button style="position:absolute;right:12px;top:12px;background:transparent;border:none;color:var(--muted);font-size:20px;cursor:pointer" onclick="closeSurvey()">✕</button>
    <h3 style="color:var(--accent1)">Анкета — Оставьте отзыв или предложение</h3>
    <form id="surveyForm" style="margin-top:10px">
      <label style="font-weight:600;display:block;margin-top:8px">Имя</label>
      <input name="s_name" required placeholder="Ваше имя">
      <label style="font-weight:600;display:block;margin-top:8px">Контакт (тел/почта)</label>
      <input name="s_contact" required placeholder="+7 (700) 000-00-00 или email@example.com">
      <label style="font-weight:600;display:block;margin-top:8px">Тип обращения</label>
      <select name="s_type" style="margin-top:8px;padding:10px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)">
        <option>Отзыв</option>
        <option>Предложение</option>
        <option>Жалоба</option>
      </select>
      <label style="font-weight:600;display:block;margin-top:8px">Сообщение</label>
      <textarea name="s_message" rows="5" placeholder="Ваше сообщение"></textarea>
      <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:12px">
        <button type="button" class="btn-ghost btn" onclick="closeSurvey()">Отмена</button>
        <button type="submit" class="btn-neon btn">Отправить</button>
      </div>
    </form>
  </div>
</div>

<!-- Lightbox -->
<div id="lightbox" class="lightbox" aria-hidden="true" onclick="closeLightbox()">
  <img id="lightboxImg" src="" alt="Фото">
</div>

<script>
/* ---------------------------
   PERFORMANCE GUARD
   --------------------------- */
const lowPerf = (() => {
  try {
    const cores = navigator.hardwareConcurrency || 4;
    const mem = navigator.deviceMemory || 4;
    return (cores <= 2 || mem <= 1);
  } catch { return false; }
})();

/* ---------------------------
   CANVAS PARTICLES / GLINTS
   --------------------------- */
const canvas = document.getElementById('fxCanvas');
const ctx = canvas.getContext('2d');
let W = canvas.width = innerWidth;
let H = canvas.height = innerHeight;
const particles = [];
const maxParticles = lowPerf ? 24 : 80;
const mouse = {x: W/2, y: H/2};

function rand(min,max){ return Math.random()*(max-min)+min; }
function createParticle(){
  return {
    x: rand(0,W),
    y: rand(0,H),
    r: rand(0.6,3.6),
    vx: rand(-0.2,0.2),
    vy: rand(-0.1,0.1),
    hue: rand(160,300),
    life: rand(80,300)
  };
}
for(let i=0;i<maxParticles;i++) particles.push(createParticle());

function resizeCanvas(){
  W = canvas.width = innerWidth;
  H = canvas.height = innerHeight;
}
addEventListener('resize', resizeCanvas);

function draw(){
  ctx.clearRect(0,0,W,H);
  // subtle radial vignette
  const g = ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0, 'rgba(2,6,23,0.0)');
  g.addColorStop(1, 'rgba(2,6,23,0.18)');
  ctx.fillStyle = g;
  ctx.fillRect(0,0,W,H);

  particles.forEach(p=>{
    p.x += p.vx + (mouse.x - W/2)*0.00006;
    p.y += p.vy + (mouse.y - H/2)*0.00003;
    p.life--;
    if(p.life<0){ Object.assign(p, createParticle()); p.life = rand(80,300); }
    // glow circle
    const g2 = ctx.createRadialGradient(p.x,p.y,p.r*0.2,p.x,p.y,p.r*6);
    g2.addColorStop(0, `hsla(${p.hue},80%,65%,0.18)`);
    g2.addColorStop(0.3, `hsla(${p.hue},80%,55%,0.08)`);
    g2.addColorStop(1, 'rgba(0,0,0,0)');
    ctx.fillStyle = g2;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r*8,0,Math.PI*2);
    ctx.fill();

    // core dot
    ctx.beginPath();
    ctx.fillStyle = `hsla(${p.hue},80%,70%,0.9)`;
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fill();
  });

  requestAnimationFrame(draw);
}
requestAnimationFrame(draw);

document.addEventListener('mousemove', e=>{
  mouse.x = e.clientX; mouse.y = e.clientY;
});

/* ---------------------------
   NAV SMOOTH LINKS
   --------------------------- */
document.querySelectorAll('nav a').forEach(a=>{
  a.addEventListener('click', e=>{
    e.preventDefault();
    const id = a.getAttribute('href');
    const el = document.querySelector(id);
    if(!el) return;
    const top = el.getBoundingClientRect().top + window.scrollY - 84;
    window.scrollTo({top,behavior:'smooth'});
  });
});

/* ---------------------------
   HERO FLOAT / PARALLAX
   --------------------------- */
const hero = document.querySelector('.hero');
document.addEventListener('mousemove', e=>{
  const rx = (e.clientX / innerWidth - 0.5) * 18;
  const ry = (e.clientY / innerHeight - 0.5) * 8;
  document.querySelectorAll('.floating').forEach((f,i)=>{
    f.style.transform = `translate(${rx*(i+1)/3}px, ${-ry*(i+1)}px)`;
  });
});

/* ---------------------------
   REVEAL ON SCROLL
   --------------------------- */
const io = new IntersectionObserver((entries)=>{
  entries.forEach(en=>{
    if(en.isIntersecting){
      en.target.style.opacity = 1;
      en.target.style.transform = 'none';
      io.unobserve(en.target);
    }
  });
},{threshold:0.14});
document.querySelectorAll('.feature, .story .photo, .gallery-item, .tech .card, .contact-card, .mission').forEach(el=>{
  el.style.opacity = 0; el.style.transform = 'translateY(22px)';
  io.observe(el);
});

/* ---------------------------
   LIGHTBOX
   --------------------------- */
const lightbox = document.getElementById('lightbox');
const lightboxImg = document.getElementById('lightboxImg');
function openLightbox(src){
  lightboxImg.src = src;
  lightbox.classList.add('open');
  lightbox.style.display = 'flex';
  lightbox.setAttribute('aria-hidden','false');
  document.body.style.overflow='hidden';
}
function closeLightbox(){
  lightbox.classList.remove('open');
  lightbox.style.display = 'none';
  lightbox.setAttribute('aria-hidden','true');
  document.body.style.overflow='';
}
lightbox.addEventListener('click', closeLightbox);
document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeLightbox(); });

/* ---------------------------
   GALLERY TILT EFFECT
   --------------------------- */
document.querySelectorAll('.gallery-item').forEach(item=>{
  item.addEventListener('mousemove', e=>{
    const r = item.getBoundingClientRect();
    const px = (e.clientX - r.left) / r.width;
    const py = (e.clientY - r.top) / r.height;
    const rx = (px - 0.5) * 10;
    const ry = (py - 0.5) * -10;
    item.style.transform = `perspective(600px) rotateX(${ry}deg) rotateY(${rx}deg) translateZ(8px)`;
  });
  item.addEventListener('mouseleave', ()=>{ item.style.transform = ''; });
});

/* ---------------------------
   SURVEY MODAL (local demo)
   --------------------------- */
const surveyModal = document.getElementById('surveyModal');
function openSurvey(){ surveyModal.classList.add('open'); surveyModal.style.display='flex'; surveyModal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; }
function closeSurvey(){ surveyModal.classList.remove('open'); surveyModal.style.display='none'; surveyModal.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }

document.getElementById('surveyForm').addEventListener('submit', e=>{
  e.preventDefault();
  const data = Object.fromEntries(new FormData(e.target).entries());
  const arr = JSON.parse(localStorage.getItem('super_survey')||'[]');
  arr.push({...data, at: Date.now()});
  localStorage.setItem('super_survey', JSON.stringify(arr));
  alert('Спасибо! Ваша анкета сохранена (локально).');
  e.target.reset();
  closeSurvey();
});

/* ---------------------------
   CONTACT FORM (demo)
   --------------------------- */
document.getElementById('contactForm').addEventListener('submit', e=>{
  e.preventDefault();
  const data = Object.fromEntries(new FormData(e.target).entries());
  // demo: save to localStorage and show toast
  const contacts = JSON.parse(localStorage.getItem('super_contacts')||'[]');
  contacts.push({...data, at: Date.now()});
  localStorage.setItem('super_contacts', JSON.stringify(contacts));
  showToast('Сообщение отправлено (демо). Спасибо!');
  e.target.reset();
});

/* ---------------------------
   TOAST
   --------------------------- */
function showToast(text){
  const t = document.createElement('div');
  t.textContent = text;
  Object.assign(t.style,{position:'fixed',left:'50%',transform:'translateX(-50%)',bottom:'26px',background:'linear-gradient(90deg,var(--accent1),var(--accent2))',color:'#03030a',padding:'10px 18px',borderRadius:'999px',boxShadow:'0 12px 36px rgba(0,0,0,0.6)',zIndex:9999,fontWeight:700});
  document.body.appendChild(t);
  setTimeout(()=>t.style.opacity='0',1800);
  setTimeout(()=>t.remove(),2200);
}

/* ---------------------------
   LIGHT SHOW (temporary flashy effect)
   --------------------------- */
function openLightShow(){
  const el = document.querySelector('.hero-frame');
  el.style.transition = 'filter .35s, opacity .35s';
  el.style.opacity = 1;
  el.style.filter = 'brightness(1.6) saturate(1.2)';
  setTimeout(()=>{ el.style.filter=''; el.style.opacity=0.35; }, 900);
}

/* ---------------------------
   Misc: Scroll to top and ESC closing
   --------------------------- */
function scrollToTop(){ window.scrollTo({top:0,behavior:'smooth'}) }
document.addEventListener('keydown', e=>{ if(e.key==='Escape'){ closeSurvey(); closeLightbox(); } });

/* ---------------------------
   Initial small animation for header and hero
   --------------------------- */
window.addEventListener('load', ()=>{
  document.querySelector('header').style.transform = 'translateY(-6px)';
  document.querySelector('header').style.opacity = '0';
  setTimeout(()=>{ document.querySelector('header').style.transform=''; document.querySelector('header').style.opacity='1'; },140);
});
</script>
</body>
</html>
